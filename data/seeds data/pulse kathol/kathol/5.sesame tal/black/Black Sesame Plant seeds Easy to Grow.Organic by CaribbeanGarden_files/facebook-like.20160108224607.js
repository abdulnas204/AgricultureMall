!function(e,n){n.ExternalAccounts&&n.ExternalAccounts.loaded||(n.ExternalAccounts=n.ExternalAccounts||{},n.ExternalAccounts.loaded=!0,n.ExternalAccounts.LinkageType={User:"user",Shop:"shop"},n.ExternalAccounts.Providers={Facebook:"facebook",Twitter:"twitter",Google:"google"},n.ExternalAccounts.ShareTypes={FavoriteListing:"favorite_item"},e.extend(n.ExternalAccounts,function(){function t(e,t,o,c,r,i,a){var u;return u=i?"connected_accounts_link_error":a?"connected_accounts_link":"connected_accounts_unlink",function(t,c){var a={php_event_name:u,service:r,object_type:o,user_id:t.etsyUid};t.shopId&&(a.shop_id=t.shopId),i&&t.errorType&&(a.error_type=t.errorType),n.EventLogger.logEvent(a),e(t,c)}}function o(e,t){if(c(t),!i(e,n.ExternalAccounts.LinkageType))throw new Error("Linkage for object type: "+e+" is not supported")}function c(e){if(!i(e,n.ExternalAccounts.Providers))throw new Error("External type: "+e+" is not supported")}function r(e){if(!i(e,n.ExternalAccounts.ShareTypes))throw new Error("Share type: "+e+" is not supported")}function i(e,n){if(void 0==e||null==e)return!1;for(var t in n)if(n[t]==e)return!0;return!1}function a(n,t,o,c,r){r=r?"/"+r:"",e.ajax({url:s+r,data:n,dataType:"json",type:"POST",success:function(e){var n=e.results;n.success?t(n,c):o(n,c)},error:function(e){o(e,c)}})}function u(e,t,o,i,u,s,d,f){c(e),r(i),f=f||"POST";var l={_nnc:n.csrf_nonce,share_type:i,method:f};a(l,u,s,d,e+"/"+t+"/"+o+"/shares/")}var s="/api/v2/ajax/external-account",d=function(c,r,i,u,s,d,f,l,p){d=d||{},f=t(f,c,r,i,u,!1,s),l=t(l,c,r,i,u,!0,!1),o(r,u);var g=e.extend({_nnc:n.csrf_nonce,external_account_type_name:u,owner_type_name:r},d);c&&(g.owner_id=c),s?g.external_account_id=i:g.method="DELETE",a(g,f,l,p)};return{connectAccounts:function(e,n,t,o,c,r,i,a){d(t,o,e,n,!0,i,c,r,a)},disconnectAccounts:function(e,n,t,o,c,r){d(n,t,null,e,!1,null,o,c,r)},checkAccountLinkedToUser:function(e,t,o,c,r){var i={_nnc:n.csrf_nonce,external_account_type_name:t};a(i,o,c,r,"account-linked-to-user/")},checkAccountIsValid:function(t,o,r,i,u,s,d){c(r),i=i||{};var f=e.extend({_nnc:n.csrf_nonce,email:t.email||"",name:t.name||"",external_account_id:o,external_account_type_name:r},i);a(f,u,s,d,"is-valid/"+o)},setAccountShare:function(e,n,t,o,c,r,i){u(e,n,t,o,c,r,i)},deleteAccountShare:function(e,n,t,o,c,r,i){u(e,n,t,o,c,r,i,"DELETE")}}}()))}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("common/etsy.external-accounts",[],function(){return window.Etsy.ExternalAccounts}),function(e,n){n.Facebook&&n.Facebook.loaded||(n.Facebook=n.Facebook||{},n.Facebook.loaded=!0,e.extend(n.Facebook,function(){var t="en_US",o=e('meta[property="fb:app_id"]').attr("content"),c="facebook",r=!1,i="default",a=n.Facebook,u=null,s=function(n){var t=e(n).data("context");return t?t:i},d=function(e){return _.uniq(e).sort()},f=function(e){return d(e).join(",")},l=["email"];return l.push("user_friends"),{load:function(i){if(i=i||function(){},r)e(document).bind("facebook:load",function(e,n){i(n)});else if(a.isConnected())i(!0);else{r=!0,window.fbAsyncInit=function(){r=!1;var n="v2.0";window.FB.init({appId:o,status:!0,cookie:!0,xfbml:!0,version:n}),e(document).trigger("facebook:load",[!0]),e(document).unbind("facebook:load")},e(document).bind("facebook:load",function(e,n){i(n)});var u=e("#fb-root").attr("data-locale"),d="//connect.facebook.net/"+(u?u:t)+"/sdk.js";e.getScript(d),e(document).bind("facebook:connect",function(e,t,o,r){var i=s(t);n.EventLogger.logEvent(o&&r?{php_event_name:"connected_accounts_oauth_accept",source:i,service:c,xauid:a.getUid(),perms:JSON.stringify(r)}:{php_event_name:"connected_accounts_oauth_refuse",source:i,service:c,perms:a.getPerms()})})}},isConnected:function(){return"undefined"!=typeof window.FB},login:function(t,o){if(!a.isConnected())throw"Facebook sdk not loaded";t||u?t&&a.setPerms(t):a.extendDefaultPerms(),a.checkPermissions(function(t){t&&_.every(t)?e(document).trigger("facebook:connect",[o,!0,t]):(n.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_open",source:s(o),service:c,perms:a.getPerms()}),window.FB.login(function(n){n.authResponse?a.checkPermissions(function(n){e(document).trigger("facebook:connect",[o,!0,n])}):e(document).trigger("facebook:connect",[o,!1,null])},{scope:a.getPerms()}))})},parse:function(e){a.isConnected()?window.FB.XFBML.parse(e):this.load(function(n){if(!n)throw"Error loading facebook SDK";document.documentElement.contains(e)&&window.FB.XFBML.parse(e)})},isLoggedIn:function(e){if(!a.isConnected())throw"Facebook SDK not loaded";window.FB.getLoginStatus(function(n){var t=null!==n.authResponse;e&&e(t)})},logout:function(e){window.FB.logout(function(){e&&e()})},getAccessToken:function(){var e=window.FB.getAuthResponse();return e?e.accessToken:null},getUid:function(){var e=window.FB.getAuthResponse();return e?e.userID:null},eventSubscribe:function(e,n){window.FB.Event.subscribe(e,n)},getProfilePictureUrl:function(e,n){return"http://graph.facebook.com/"+(e||this.getUid())+"/picture?type="+(n||"large")},fetchUser:function(e){window.FB.api("/me",function(t){if(0==t||t.error)0==t?t={type:n.ExternalAccounts.Providers.Facebook,errorType:"facebook_user_type_error",errorMsg:n.template("facebook_user_type_error",!0)}:t.error&&(t.errorType="facebook_api_error",t.errorMsg=n.template("facebook_connect_error",!0),t.type=n.ExternalAccounts.Providers.Facebook),e(!1,t);else{var o={email:t.email,name:t.name,firstName:t.first_name,lastName:t.last_name,gender:t.gender,birthday:null,username:t.username,id:t.id,avatar:a.getProfilePictureUrl(),avatarSmall:a.getProfilePictureUrl(null,"square"),link:t.link,type:n.ExternalAccounts.Providers.Facebook};e(!0,o)}})},postToPage:function(e,n,t,o,c){n.from=t,this.postToFeed(e,n,o,c)},postToFeed:function(n,t,o,c){if(!a.isConnected())throw"Facebook sdk not loaded";if(!n)throw"Etsy.Facebook.postToFeed: link is a required argument";t=t||{},t=e.each(t,function(e,n){(null==n||void 0==n)&&delete t.key});var r={method:"feed",link:n};e.extend(r,t),window.FB.ui(r,function(e){e&&e.post_id?"function"==typeof o&&o(e):"function"==typeof c&&c(e)})},extendDefaultPerms:function(e){var n=[];return e&&(n=e.split(",")),n=n.concat(l),u=f(n)},setPerms:function(e){var n=[];return e&&(n=e.split(",")),u=f(n)},getPerms:function(){return u},getDefaultPerms:function(){return l},reset:function(){r=!1,i="default",u=null},checkPermissions:function(t,o){var c;n.Logger.info("Checking fb permissions for "+JSON.stringify(o)),a.isLoggedIn(function(n){if(!n)return t.apply(a,[null]);if(o?o=d(o):(c=a.getPerms(),c||(c=a.extendDefaultPerms()),o=c.split(",")),!o||o.length<1)return t.apply(a,[[]]);var r={};e.each(o,function(e,n){r[n]=!1}),window.FB.api("/me/permissions",function(n){!n.error&&n.data&&n.data.length&&e.each(n.data,function(e,n){r[n.permission]="granted"==n.status}),t.apply(a,[r])})})},setContext:function(e){i=e}}}()),e.extend(n.Facebook,function(){var t=n.Facebook,o=function(t){e(document).trigger("facebook:account-disconnect-begin"),n.ExternalAccounts.disconnectAccounts(n.ExternalAccounts.Providers.Facebook,null,n.ExternalAccounts.LinkageType.User,function(){e(document).trigger("facebook:account-disconnect",[t,!0])},function(){e(document).trigger("facebook:account-disconnect",[t,!1])})},c=function(e,o,c,r){var i=n.ExternalAccounts.Providers.Facebook,a=n.ExternalAccounts.LinkageType.User,u=t.getUid();o?n.ExternalAccounts.setAccountShare(i,u,a,e,c,r):n.ExternalAccounts.deleteAccountShare(i,u,a,e,c,r)};return{initLoginButton:function(n,o){n&&("object"!=typeof n||n.length)&&(e(n).bind("click",function(e){e.preventDefault(),t.login(o,n)}),e(n).trigger("facebook:connect-button-active"))},initConnectButton:function(o,c,r,i){o&&("object"!=typeof o||o.length)&&("undefined"==typeof c&&(c=!0),i=i||"",r=r||{},e(o).bind("click",function(a){a.preventDefault(),c&&e(document).one("facebook:connect",function(c,a,u,s){var d=i?i.split(","):[],f=s&&_.every(d,function(e){return s[e]});if(u&&f&&(n.Mobile&&"undefined"!=typeof n.Mobile.isSignedIn?n.Mobile.isSignedIn:n.isSignedIn())){var l=[o];n.ExternalAccounts.connectAccounts(t.getUid(),n.ExternalAccounts.Providers.Facebook,null,n.ExternalAccounts.LinkageType.User,function(){e(document).trigger("facebook:account-connect",e.merge(l,arguments))},function(){e(document).trigger("facebook:account-connect-error",e.merge(l,arguments))},r)}}),t.extendDefaultPerms(i),t.login(t.getPerms(),o)}),e(o).trigger("facebook:connect-button-active"))},initDisconnectButton:function(n){e(n).bind("click",function(e){e.preventDefault(),o(n)})},accountConnected:function(e){n.ExternalAccounts.checkAccountLinkedToUser(t.getUid(),n.ExternalAccounts.Providers.Facebook,function(n){n.success?e.apply(null,[n.linked]):e.apply(null,[!1])},function(){e.apply(null,[!1])})},addShareOfType:function(t,o,r){e(document).one("facebook:connect",function(e,n,i,a){i&&a&&a.publish_actions?c(t,!0,o,r):r()}),n.Facebook.login("publish_actions",null)},removeShareOfType:function(e,n,t){c(e,!1,n,t)}}}()))}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("common/etsy.facebook",[],function(){return window.Etsy.Facebook}),function(e,n){function t(e){return function(){var t={php_event_name:"share_facebook",button_name:e};n.Context.data.listingId&&(t.listing_id=n.Context.data.listingId),c&&(t.source=c),r&&(t.post_to_page=r),n.EventLogger.logEvent(t)}}if(!n.Facebook||!n.Facebook.likeButtonInitialized){var o=e("fb\\:like"),c=o.data("share_from"),r=o.data("fb_page_url");n.Facebook.load(function(){n.Facebook.eventSubscribe("edge.create",t("like")),n.Facebook.eventSubscribe("message.send",t("send")),c&&"listing"==c&&n.Context.data.listingId&&n.Facebook.eventSubscribe("edge.create",function(){jQuery.ajax({type:"post",url:"/api/v2/ajax/track-stats/shared_listing_facebook/"+n.Context.data.listingId,data:{_nnc:n.csrf_nonce},dataType:"json"})}),n.Facebook.likeButtonInitialized=!0})}}(window.jQuery||window.Zepto,window.Etsy),define("bootstrap/facebook-like",[],function(){});